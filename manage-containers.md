# Docker 容器启动与维护管理脚本

## 功能简介

`manage-containers.sh` 是一个专门用于启动和维护 Docker 容器的综合管理脚本。主要功能包括：

1. **容器启动管理**
   - 自动扫描并启动所有容器
   - 智能处理启动顺序
   - 自动更新容器镜像
   - 并行处理多个容器

2. **网络管理**
   - 自动检测网络配置
   - 修复损坏的网络连接
   - 重建异常网络
   - 维护网络隔离

3. **健康监控**
   - 实时监控容器状态
   - 自动检测服务健康
   - 详细的启动日志
   - 错误自动报告

## 使用方法

### 基本使用
```bash
sudo ./manage-containers.sh
```

### 执行流程
1. 扫描 docker-compose 配置
2. 更新容器镜像
3. 启动所有容器
4. 验证运行状态

### 维护功能
- 清理未使用的网络
- 移除旧版本镜像
- 优化系统资源
- 监控服务状态

## 重要特性

### 智能启动机制
- 自动检测 compose 文件
- 支持多种配置格式
- 优化启动顺序
- 自动重试机制

### 网络管理
- 网络配置验证
- 自动修复机制
- 连接状态监控
- 网络隔离维护

### 资源优化
- 清理未使用镜像
- 管理网络资源
- 优化系统性能
- 自动垃圾回收

## 目录结构

```
/mnt/user/
├── appdata/              # 容器数据目录
│   ├── container1/      # 容器配置目录
│   │   └── docker-compose.yml
│   └── container2/
│       └── docker-compose.yml
└── logs/                # 脚本运行日志
```

## 执行过程

1. **初始化检查**
   - 验证运行权限
   - 检查 Docker 状态
   - 扫描配置文件
   - 确认目录权限

2. **容器处理**
   - 停止现有容器
   - 更新容器镜像
   - 启动新容器
   - 验证运行状态

3. **网络维护**
   - 检查网络配置
   - 修复异常连接
   - 清理未用网络
   - 验证网络状态

4. **资源管理**
   - 清理旧镜像
   - 优化存储空间
   - 管理系统资源
   - 更新运行环境

## 注意事项

1. **运行要求**
   - 需要 root 权限
   - Docker 环境
   - docker-compose
   - 网络连接

2. **操作说明**
   - 自动处理所有容器
   - 支持批量操作
   - 实时状态监控
   - 详细日志记录

3. **重要提示**
   - 确保网络稳定
   - 监控系统资源
   - 关注错误日志
   - 定期维护检查

## 错误处理

1. **常见问题**
   - 容器启动失败
   - 网络配置错误
   - 镜像更新失败
   - 资源不足

2. **故障排除**
   - 检查错误日志
   - 验证网络连接
   - 确认配置正确
   - 查看容器状态

## 技术支持

- 日志位置：`/mnt/user/logs/docker_start_*.log`
- 配置目录：`/mnt/user/appdata/`
- 运行状态：使用 `docker ps` 查看

## 最佳实践

1. **定期维护**
   - 定期更新镜像
   - 检查容器状态
   - 清理系统资源
   - 优化运行配置

2. **监控建议**
   - 关注容器日志
   - 检查网络状态
   - 监控资源使用
   - 定期状态检查

3. **性能优化**
   - 合理分配资源
   - 优化网络配置
   - 定期清理缓存
   - 更新系统组件

## 使用场景

1. **系统启动时**
   - 自动启动所有容器
   - 检查系统状态
   - 验证服务可用性

2. **日常维护时**
   - 更新容器镜像
   - 优化系统资源
   - 清理无用数据

3. **问题排查时**
   - 检查容器状态
   - 分析错误日志
   - 修复网络问题
   - 重启异常服务 